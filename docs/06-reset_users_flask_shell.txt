# =====================================================
# FILE: reset_users_flask_shell.txt
# PURPOSE: Clear users table using Flask shell (Windows)
# DATABASE: SQLite (auth.db) OR Neon (if DATABASE_URL set)
# NOTE: sqlite3 CLI is NOT required
# =====================================================

# -----------------------------------------------------
# Open PowerShell in this directory:
# E:\ecommerce-platform\backends\backend-auth-service
# -----------------------------------------------------

# Step 1: Activate virtual environment
venv\Scripts\activate

# -----------------------------------------------------
# Step 2: Open Flask shell
# IMPORTANT:
# - If DATABASE_URL is NOT set → SQLite (auth.db)
# - If DATABASE_URL IS set     → Neon PostgreSQL
# -----------------------------------------------------
flask shell

# -----------------------------------------------------
# Step 3: Inside Flask shell (Python prompt >>>)
# -----------------------------------------------------

from app.extensions import db
from app.models.user import User

# Delete all rows from users table
db.session.query(User).delete()

# Commit changes
db.session.commit()

# Exit shell
exit()

# -----------------------------------------------------
# Step 4: Restart auth backend
# -----------------------------------------------------
flask run --port 5001

# -----------------------------------------------------
# After this:
# - Re-register seller / user from Angular or curl
# - Login will succeed (password hashing OK)
# - IDs reset for SQLite (may continue for Postgres)
# -----------------------------------------------------
